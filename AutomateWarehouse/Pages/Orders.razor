@page "/allOrders"
@using AutomateWarehouse.Data
@inject OrderRepository orderRepo

<h3>All orders</h3>

<div class="container">

    <table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Customer id</th>
                <th>Order date</th>
                <th>Delivery address</th>
                <th>Payment completed</th>
                <th>Order dispatched</th>
                <th>Edit order</th>
                <th>Pay order</th>
            </tr>
        </thead>
        <tbody>
            @if (orders.Any())
            {
                @foreach (var orde in orders)
                {
                    <tr>
                        <td>@orde.CustomerId</td>
                        <td>@orde.OrderDate</td>
                        <td>@orde.DeliveryAddress</td>
                        <td>@orde.PaymentCompleted</td>
                        <td>@orde.Dispatched</td>
                        <td><button class="btn btn-info">Edit</button></td>
                        <td>
                            <input type="checkbox" onchange="document.getElementById('PayButton').disabled = !this.checked;" />
                            <input type="button" name="PayButton" class="btn btn-info" id="PayButton" value="PayButton" disabled @onclick="(() => PayOrderAsync(orde))" />
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <button class="btn btn-info" @onclick="(() => GetAllDispatchedOrdersAsync())">Show all dispatched orders</button>

    <button class="btn btn-info" @onclick="(() => GetAllPendingdOrdersAsync())">Show all pending orders</button>

    <button class="btn btn-info">Process all orders</button>
</div>


<div class="row m-5">
    <div class="col-5 bg-light m-2 justify-content-start">
        <div class="p-3 mb-3 bg-primary text-white text-center">
            Add new Order
        </div>
        <EditForm Model="@newOrder" OnValidSubmit="@AddNewOrder">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="form-group">
                @*Binder respektive värde nedanför till objektet newOrder*@
                <select type="text" id="dept" class="form-control custom-select picker">
                    <option value="">Customer</option>
                    <option value="1">Book title</option>
                </select>
                <br>
                <label for="name">Address</label>
                <input type="type" id="Address" class="form-control" @*@bind-value="@newOrder.Address" *@ />
                <br>
                <select type="text" id="dept" class="form-control custom-select picker">
                    <option value="">Product</option>
                    <option value="1">Book title</option>
                </select>
                <br>
                <button class="btn btn-info"> + </button>
                <button class="btn btn-info"> - </button>
                <br>
                <div class="text-center p-3 mb-3">
                    <button class="btn btn-info" type="submit">Add Order</button>
                </div>
            </div>
        </EditForm>
    </div>
</div>

<div class="row m-5">
    <div class="col-5 bg-light m-2 justify-content-start">
        <div class="p-3 mb-3 bg-primary text-white text-center">
            Edit Order
        </div>
        <EditForm Model="@updateOrder" OnValidSubmit="(() => EditOrder())">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="form-group">
                @*Binder respektive värde nedanför till objektet updateOrder*@
                <label for="name">Name</label>
                <input type="type" id="name" class="form-control" @*@bind-value="@newOrder.Name"*@ />
            </div>

            <div class="text-center p-3 mb-3">
                <button class="btn btn-info" type="submit">Edit Order</button>
            </div>
        </EditForm>
    </div>
</div>









@*<div class="container">
        @if (ordersDispatched.Any())
        {
            <table class="table table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Customer id</th>
                        <th>Order date</th>
                        <th>Delivery address</th>
                        <th>Payment completed</th>
                        <th>Order dispatched</th>
                        <th>Edit order</th>
                        <th>Pay order</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var orde in ordersDispatched)
                    {
                        <tr>
                            <td>@orde.CustomerId</td>
                            <td>@orde.OrderDate</td>
                            <td>@orde.DeliveryAddress</td>
                            <td>@orde.PaymentCompleted</td>
                            <td>@orde.Dispatched</td>
                            <td><button class="btn btn-info">Edit</button></td>
                            <td>
                                <input type="checkbox" onchange="document.getElementById('PayButton').disabled = !this.checked;" />
                                <input type="button" name="PayButton" class="btn btn-info" id="PayButton" value="PayButton" disabled @onclick="(() => PayOrderAsync(orde))" />
                            </td>
                        </tr>
                    }
                    }
                </tbody>
            </table>
        }
    </div>*@

@*<div class="container">
        @if (ordersPending.Any())
        {
            <table class="table table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Customer id</th>
                        <th>Order date</th>
                        <th>Delivery address</th>
                        <th>Payment completed</th>
                        <th>Order dispatched</th>
                        <th>Edit order</th>
                        <th>Pay order</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var orde in ordersPending)
                    {
                        <tr>
                            <td>@orde.CustomerId</td>
                            <td>@orde.OrderDate</td>
                            <td>@orde.DeliveryAddress</td>
                            <td>@orde.PaymentCompleted</td>
                            <td>@orde.Dispatched</td>
                            <td><button class="btn btn-info">Edit</button></td>
                            <td>
                                <input type="checkbox" onchange="document.getElementById('PayButton').disabled = !this.checked;" />
                                <input type="button" name="PayButton" class="btn btn-info" id="PayButton" value="PayButton" disabled @onclick="(() => PayOrderAsync(orde))" />
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
        }
    </div>*@



@code {
    private List<Order> orders;
    private List<Order> ordersDispatched = new List<Order>();
    private List<Order> ordersPending = new List<Order>();

    Order newOrder = new Order();
    Order updateOrder = new Order();
    bool checkedValue = false;

    protected override async Task OnInitializedAsync()
    {
        orders = await orderRepo.GetAllOrdersAsync();
    }

    private async Task AddNewOrder()
    {
        await orderRepo.AddNewOrderAsync(newOrder);
        await UpdateGUI();
    }

    private async Task EditOrder()
        {

        }


    private async Task PayOrderAsync(Order order)
    {
        await orderRepo.PayOrderAsync(order);
        await UpdateGUI();
    }

    private async Task GetAllDispatchedOrdersAsync()
    {
        ordersDispatched = await orderRepo.GetAllDispatchedOrdersAsync();
    }

    private async Task GetAllPendingdOrdersAsync()
    {
        ordersPending = await orderRepo.GetAllPendingOrdersAsync();
    }

    protected async Task UpdateGUI()
    {
        orders = await orderRepo.GetAllOrdersAsync();
    }
}
